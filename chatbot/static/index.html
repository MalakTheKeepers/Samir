<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Samir - مساعدك الذكي</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; }
        header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        header p { font-size: 1.1rem; opacity: 0.9; }
        .tabs { display: flex; background: #f8f9fa; border-bottom: 1px solid #e9ecef; }
        .tab-btn { flex: 1; padding: 15px 20px; border: none; background: transparent; cursor: pointer; font-size: 1rem; font-weight: 500; color: #6c757d; transition: all 0.3s ease; border-bottom: 3px solid transparent; }
        .tab-btn:hover { background: #e9ecef; color: #495057; }
        .tab-btn.active { color: #667eea; border-bottom-color: #667eea; background: white; }
        .tab-content { display: none; padding: 30px; min-height: 500px; }
        .tab-content.active { display: block; }
        .chat-container { min-height: 400px; height: auto; display: flex; flex-direction: column; flex: 1; }
        .topic-buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px; border: 1px solid #e9ecef; }
        .topic-btn { padding: 10px 15px; background: #667eea; color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 0.9rem; font-weight: 500; transition: all 0.3s ease; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .topic-btn:hover { background: #5a6fd8; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .messages { flex: 1; overflow-y: auto; padding: 20px; background: #f8f9fa; border-radius: 15px; margin-bottom: 20px; border: 1px solid #e9ecef; }
        .message { margin: 15px 0; padding: 12px 18px; border-radius: 18px; max-width: 80%; word-wrap: break-word; animation: fadeIn 0.3s ease; }
        .message.user { background: #667eea; color: white; margin-left: auto; text-align: right; }
        .message.bot { background: white; color: #333; border: 1px solid #e9ecef; margin-right: auto; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .input-area { display: flex; gap: 10px; align-items: center; }
        #user-input { flex: 1; padding: 15px 20px; border: 2px solid #e9ecef; border-radius: 25px; font-size: 1rem; outline: none; transition: border-color 0.3s ease; }
        #user-input:focus { border-color: #667eea; }
        .send-btn { padding: 15px 20px; background: #667eea; color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 1.2rem; transition: all 0.3s ease; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; }
        .send-btn:hover { background: #5a6fd8; transform: scale(1.05); }
        .quiz-list { display: grid; gap: 15px; margin-top: 20px; }
        .quiz-item { padding: 20px; background: #f8f9fa; border-radius: 10px; border: 2px solid #e9ecef; cursor: pointer; transition: all 0.3s ease; }
        .quiz-item:hover { border-color: #667eea; background: #e3f2fd; transform: translateY(-2px); }
        .quiz-item h4 { color: #333; margin-bottom: 5px; }
        .quiz-item p { color: #6c757d; font-size: 0.9rem; }
        .quiz-content { margin-top: 20px; }
        .quiz-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 15px; border-bottom: 2px solid #e9ecef; }
        .quiz-progress { background: #667eea; color: white; padding: 8px 16px; border-radius: 20px; font-weight: 500; }
        .quiz-question { font-size: 1.3rem; font-weight: 500; margin-bottom: 25px; color: #333; }
        .quiz-options { margin-bottom: 30px; }
        .option { display: block; width: 100%; padding: 15px 20px; margin: 10px 0; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 10px; cursor: pointer; transition: all 0.3s ease; text-align: left; font-size: 1rem; }
        .option:hover { border-color: #667eea; background: #e3f2fd; }
        .option.selected { border-color: #667eea; background: #e3f2fd; color: #667eea; font-weight: 500; }
        .option.correct { border-color: #28a745; background: #d4edda; color: #155724; }
        .option.incorrect { border-color: #dc3545; background: #f8d7da; color: #721c24; }
        .quiz-controls { display: flex; gap: 15px; justify-content: center; }
        .quiz-controls button { padding: 12px 24px; border: none; border-radius: 25px; cursor: pointer; font-size: 1rem; font-weight: 500; transition: all 0.3s ease; }
        #prev-btn, #next-btn { background: #6c757d; color: white; }
        #prev-btn:hover, #next-btn:hover { background: #5a6268; }
        #prev-btn:disabled { background: #e9ecef; color: #6c757d; cursor: not-allowed; }
        #submit-btn { background: #28a745; color: white; }
        #submit-btn:hover { background: #218838; }
        .quiz-results { text-align: center; padding: 30px; background: #f8f9fa; border-radius: 15px; margin-top: 20px; }
        .score { font-size: 2rem; font-weight: bold; color: #667eea; margin-bottom: 15px; }
        @media (max-width: 768px) { 
            .container { margin: 10px; border-radius: 15px; } 
            header { padding: 20px; } 
            header h1 { font-size: 2rem; } 
            .tab-content { padding: 20px; } 
            .quiz-controls { flex-direction: column; } 
            .quiz-controls button { width: 100%; } 
            
            /* Mobile-specific chat message improvements */
            .messages {
                padding: 25px 15px !important;
                font-size: 1.1rem !important;
                line-height: 1.6 !important;
                min-height: 50vh !important;
                height: auto !important;
                overflow-y: auto !important;
                scroll-behavior: smooth !important;
                flex: 1 !important;
            }
            
            .message {
                font-size: 1.2rem !important;
                padding: 20px 25px !important;
                margin: 22px 0 !important;
                line-height: 1.8 !important;
                max-width: 95% !important;
                border-radius: 22px !important;
                word-wrap: break-word !important;
            }
            
            .message.user {
                font-size: 1.2rem !important;
                padding: 20px 25px !important;
                line-height: 1.7 !important;
            }
            
            .message.bot {
                font-size: 1.2rem !important;
                padding: 20px 25px !important;
                line-height: 1.9 !important;
                word-spacing: 0.15em !important;
                letter-spacing: 0.02em !important;
            }
            
            .topic-btn {
                font-size: 1.1rem !important;
                padding: 16px 22px !important;
                line-height: 1.5 !important;
            }
            
            .topic-buttons {
                padding: 25px !important;
                gap: 15px !important;
            }
            
            #user-input {
                font-size: 1.2rem !important;
                padding: 22px 26px !important;
                line-height: 1.6 !important;
                width: calc(100% - 80px) !important;
                max-width: calc(100vw - 120px) !important;
            }
            
            .input-area {
                display: flex !important;
                gap: 15px !important;
                align-items: center !important;
                width: 100% !important;
                padding: 0 10px !important;
            }
            
            .send-btn {
                width: 60px !important;
                height: 60px !important;
                font-size: 1.4rem !important;
            }
            
            .chat-container {
                min-height: 60vh !important;
                height: auto !important;
                flex: 1 !important;
            }
            
            .tab-content {
                padding: 15px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-robot"></i> Samir - مساعدك الذكي</h1>
            <p>Ask questions and take quizzes! / اسأل وأخضع للاختبارات!</p>
        </header>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('chat')">
                <i class="fas fa-comments"></i> Chat / محادثة
            </button>
            <button class="tab-btn" onclick="switchTab('quiz')">
                <i class="fas fa-question-circle"></i> Quiz / اختبار
            </button>
        </div>

        <!-- Chat Tab -->
        <div id="chat-tab" class="tab-content active">
            <div class="chat-container">
                <div id="topic-buttons" class="topic-buttons">
                    <button class="topic-btn" onclick="sendTopicMessage('المخاطر التي تواجه الإسكندرية')">المخاطر التي تواجه الإسكندرية</button>
                    <button class="topic-btn" onclick="sendTopicMessage('أهمية إعادة التدوير')">أهمية إعادة التدوير</button>
                    <button class="topic-btn" onclick="sendTopicMessage('المناطق التي يجب الإهتمام بها')">المناطق التي يجب الإهتمام بها</button>
                    <button class="topic-btn" onclick="sendTopicMessage('أضرار البلاستيك')">أضرار البلاستيك</button>
                    <button class="topic-btn" onclick="sendTopicMessage('ما هو سمير')">ما هو سمير</button>
                    <button class="topic-btn" onclick="sendTopicMessage('كيفية احتساب واستبدال النقاط')">كيفية احتساب واستبدال النقاط</button>
                    <button class="topic-btn" onclick="sendTopicMessage('ماهي التنمية المستدامة')">ماهي التنمية المستدامة</button>
                    <button class="topic-btn" onclick="sendTopicMessage('من نحن')">من نحن</button>
                </div>
                <div id="messages" class="messages"></div>
                <div class="input-area">
                    <input type="text" id="user-input" placeholder="Ask me anything... / اسألني أي شيء..." onkeypress="handleKeyPress(event)">
                    <button onclick="sendMessage()" class="send-btn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Quiz Tab -->
        <div id="quiz-tab" class="tab-content">
            <div class="quiz-container">
                <div id="quiz-selection">
                    <h3>Select a Quiz</h3>
                    <div id="quiz-list" class="quiz-list"></div>
                </div>
                <div id="quiz-content" class="quiz-content" style="display: none;">
                    <div class="quiz-header">
                        <h3 id="quiz-title"></h3>
                        <div class="quiz-progress">
                            <span id="current-question">1</span> / <span id="total-questions">5</span>
                        </div>
                    </div>
                    <div id="quiz-question" class="quiz-question"></div>
                    <div id="quiz-options" class="quiz-options"></div>
                    <div class="quiz-controls">
                        <button id="prev-btn" onclick="previousQuestion()" disabled>Previous</button>
                        <button id="next-btn" onclick="nextQuestion()">Next</button>
                        <button id="submit-btn" onclick="submitQuiz()" style="display: none;">Submit Quiz</button>
                    </div>
                    <div id="quiz-results" class="quiz-results" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let chatbotData = null;
        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let quizScore = 0;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadChatbotData();
            initializeTabs();
            addWelcomeMessage();
        });

        // Load chatbot data
        function loadChatbotData() {
            chatbotData = {
                "texts": [
                    {
                        "id": "intro",
                        "title": "Welcome to the Chatbot",
                        "content": "Hello! I'm a simple chatbot that can help you with texts and quizzes. I can answer questions about various topics and generate quizzes for you to practice.",
                        "keywords": ["welcome", "hello", "help", "introduction"]
                    },
                    {
                        "id": "alex_climate_ar",
                        "title": "الإسكندرية بين التغيرات المناخية وحلول الاستدامة: مشروع سمير نموذجًا",
                        "content": "تواجه الإسكندرية تحديات بيئية بسبب ارتفاع مستوى سطح البحر والتغيرات المناخية، مما يهدد مواقع أثرية وثقافية مثل قلعة قايتباي ومقابر الشاطبي والأنفوشي. يفاقم التلوث البلاستيكي الوضع عبر الميكروبلاستيك وتأثيراته البيئية والصحية. يقدم مشروع سمير حلولًا عملية: خريطة تفاعلية للمناطق المعرضة للفيضانات، مساعد ذكي للتوعية ونصائح الاستدامة، وآلية نقاط لتحفيز إعادة التدوير عبر QR وربطها بشركات معتمدة. يهدف المشروع لتعزيز الوعي، إشراك المجتمع والقطاع الخاص، ودعم السياحة البيئية وحماية التراث، مع قابلية التوسع لمدن ساحلية أخرى.",
                        "keywords": ["الإسكندرية", "اسكندرية", "تغيرات مناخية", "الاستدامة", "البلاستيك", "الميكروبلاستيك", "قلعة قايتباي", "مشروع سمير", "إعادة التدوير", "فيضانات", "خريطة تفاعلية"]
                    }
                ],
                "quizzes": [
                    {
                        "id": "math_quiz_1",
                        "title": "Basic Math Quiz",
                        "questions": [
                            {
                                "id": 1,
                                "question": "What is 5 + 3?",
                                "options": ["6", "7", "8", "9"],
                                "correct": 2,
                                "explanation": "5 + 3 = 8"
                            },
                            {
                                "id": 2,
                                "question": "What is 12 - 4?",
                                "options": ["6", "7", "8", "9"],
                                "correct": 2,
                                "explanation": "12 - 4 = 8"
                            },
                            {
                                "id": 3,
                                "question": "What is 3 × 4?",
                                "options": ["10", "11", "12", "13"],
                                "correct": 2,
                                "explanation": "3 × 4 = 12"
                            }
                        ]
                    },
                    {
                        "id": "alex_quiz_ar",
                        "title": "اختبار: الإسكندرية والمناخ والاستدامة",
                        "questions": [
                            {
                                "id": 1,
                                "question": "ما الخطر المناخي الأبرز الذي يهدد الإسكندرية؟",
                                "options": ["الزلازل", "ارتفاع مستوى سطح البحر", "العواصف الرملية", "الجفاف فقط"],
                                "correct": 1,
                                "explanation": "تشير الدراسات إلى أن ارتفاع مستوى سطح البحر قد يؤدي لفقدان أجزاء من المدينة."
                            },
                            {
                                "id": 2,
                                "question": "أي من المعالم التالية ضمن نطاق الخطر؟",
                                "options": ["الأهرامات", "قلعة قايتباي", "سد العالي", "معبد الكرنك"],
                                "correct": 1,
                                "explanation": "قلعة قايتباي معرّضة لفقدان نسبة من مساحتها وفق سيناريوهات مناخية."
                            },
                            {
                                "id": 3,
                                "question": "ما المشكلة الرئيسية للبلاستيك في البيئة البحرية؟",
                                "options": ["يتحلل خلال أيام", "يتحول إلى ميكروبلاستيك يدخل السلسلة الغذائية", "ينظف المياه", "يزيد الأكسجين"],
                                "correct": 1,
                                "explanation": "الميكروبلاستيك يدخل في السلسلة الغذائية ويؤثر على الإنسان."
                            }
                        ]
                    }
                ],
                "responses": {
                    "greetings": [
                        "Hello! How can I help you today?",
                        "مرحبًا! كيف يمكنني مساعدتك اليوم؟",
                        "أهلًا بك! ماذا تحب أن تتعلم؟"
                    ],
                    "help": [
                        "I can help you with texts and quizzes. Try asking about a topic or request a quiz!",
                        "أستطيع مساعدتك في النصوص والاختبارات. اسأل عن موضوع أو اطلب اختبارًا!"
                    ],
                    "unknown": [
                        "I'm not sure about that. Can you try asking about a specific topic or request a quiz?",
                        "لست متأكدًا من ذلك. جرّب السؤال عن موضوع محدد أو اطلب اختبارًا."
                    ]
                }
            };
            loadQuizzes();
        }

        // Tab switching functionality
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(btn => {
                const attr = btn.getAttribute('onclick') || '';
                if (attr.includes("'" + tabName + "'")) {
                    btn.classList.add('active');
                }
            });
        }

        // Initialize tabs
        function initializeTabs() {
            const tabButtons = document.querySelectorAll('.tab-btn');
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const match = (this.getAttribute('onclick') || '').match(/'([^']+)'/);
                    const tabName = match ? match[1] : 'chat';
                    switchTab(tabName);
                });
            });
        }

        // Add welcome message
        function addWelcomeMessage() {
            setTimeout(() => {
                appendMessage('bot', 'مرحبًا! أنا سمير، مساعدك الذكي للتوعية بالمناخ وإعادة التدوير. يمكنني مساعدتك في فهم المخاطر التي تواجه الإسكندرية وحلول الاستدامة. اضغط على الأزرار أدناه أو اسألني مباشرة!');
            }, 500);
        }

        // Chat functionality
        function appendMessage(sender, text) {
            const messagesDiv = document.getElementById('messages');
            const div = document.createElement('div');
            div.classList.add('message', sender);
            div.textContent = text;
            messagesDiv.appendChild(div);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function sendMessage() {
            const userInput = document.getElementById('user-input');
            const msg = userInput.value.trim();
            if (!msg) return;
            
            appendMessage('user', msg);
            userInput.value = '';
            
            const response = processMessage(msg);
            setTimeout(() => {
                appendMessage('bot', response);
            }, 500);
        }

        function sendTopicMessage(topic) {
            // Clear previous messages
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = '';
            
            // Add the new topic message
            appendMessage('user', topic);
            const response = processMessage(topic);
            setTimeout(() => {
                appendMessage('bot', response);
            }, 500);
        }

        function processMessage(message) {
            if (!chatbotData) return 'I\'m still loading my knowledge base. Please wait a moment.';
            
            const lowerMessage = message.toLowerCase();
            const isArabic = /[\u0600-\u06FF]/.test(message);
            
            // Check for keyword-based responses
            if (lowerMessage.includes('الاسكندرية') || lowerMessage.includes('اسكندرية') || lowerMessage.includes('الإسكندرية')) {
                return 'الإسكندرية هي مدينة مصرية ساحلية مهددة بيئياً بسبب مخاطر ارتفاع مستوى البحر والتغيرات المناخية الناجمة عن تلوث البيئة. تواجه المدينة تحديات كبيرة تشمل:\n\n• ارتفاع مستوى سطح البحر الذي قد يؤدي لفقدان أجزاء واسعة من المدينة\n• التغيرات المناخية التي تهدد المواقع الأثرية والثقافية\n• التلوث البلاستيكي الذي يؤثر على البيئة البحرية والصحة العامة\n• المعالم المهددة مثل قلعة قايتباي ومقابر الشاطبي والأنفوشي\n\nهذه المخاطر تتطلب حلولاً شاملة ومستدامة لحماية تراثنا وبيئتنا.';
            }
            
            if (lowerMessage.includes('إعادة التدوير') || lowerMessage.includes('تدوير') || lowerMessage.includes('إعادة تدوير')) {
                return 'أهمية إعادة التدوير:\n\n• حماية البيئة: تقليل النفايات والتلوث\n• توفير الموارد: استخدام المواد مرة أخرى بدلاً من استخراج مواد جديدة\n• دعم الاقتصاد: خلق فرص عمل في صناعة إعادة التدوير\n• حماية الصحة: تقليل المخاطر الصحية من التلوث البلاستيكي\n• الاستدامة: ضمان موارد للأجيال القادمة\n\nمشروع سمير يحفز إعادة التدوير عبر نظام النقاط الذي يربط الأسر بشركات إعادة التدوير المعتمدة.';
            }
            
            if (lowerMessage.includes('المناطق') || lowerMessage.includes('منطقة') || lowerMessage.includes('اهتمام') || lowerMessage.includes('اهتمام')) {
                return 'المناطق التي تحتاج اهتمام خاص:\n\n• المناطق الساحلية: الأكثر عرضة لارتفاع مستوى البحر\n• المواقع الأثرية: قلعة قايتباي، مقابر الشاطبي والأنفوشي\n• المناطق الصناعية: مصادر التلوث البلاستيكي\n• الأحياء السكنية: لتعزيز الوعي والمشاركة المجتمعية\n• الموانئ والمرافئ: نقاط تجمع النفايات البحرية\n\nالخريطة التفاعلية في مشروع سمير تبرز هذه المناطق بالألوان لتسهيل فهم المخاطر.';
            }
            
            if (lowerMessage.includes('البلاستيك') || lowerMessage.includes('بلاستيك') || lowerMessage.includes('أضرار') || lowerMessage.includes('ضرر')) {
                return 'أضرار البلاستيك على البيئة والصحة:\n\nالبيئة:\n• لا يتحلل بسهولة، يتحول لميكروبلاستيك\n• يدخل في التربة والأنهار والبحار\n• يضر بالنظام البيئي والكائنات البحرية\n\nالصحة:\n• يزيد معدلات السرطان خاصة في الجهاز الهضمي والكبد\n• يسبب مشاكل رئوية مثل الالتهابات المزمنة والربو\n• يؤثر على الجهاز العصبي للأطفال\n• يعزز تراكم البكتيريا في الزجاجات المعاد استخدامها\n\nلذلك نحتاج لحلول آمنة لإعادة التدوير.';
            }
            
            if (lowerMessage.includes('سمير') || lowerMessage.includes('مشروع سمير')) {
                return 'سمير هو مشروع ذكي للتوعية بالمناخ وإعادة التدوير:\n\nالأدوات:\n• الخريطة التفاعلية: تظهر المناطق المعرضة للفيضانات\n• المساعد الذكي: يجيب على الأسئلة ويقدم نصائح عملية\n• آلة النقاط: تحول الزجاجات الفارغة لنقاط قابلة للاستبدال\n\nالأهداف:\n• ربط المعرفة الأكاديمية بالعمل الشعبي\n• تحفيز المشاركة المجتمعية\n• دعم السياحة البيئية\n• حماية التراث من المخاطر المناخية\n\nسمير يهدف لجعل مصر نموذجاً رائداً في المنطقة للاستدامة.';
            }
            
            if (lowerMessage.includes('النقاط') || lowerMessage.includes('نقاط') || lowerMessage.includes('استبدال') || lowerMessage.includes('احتساب')) {
                return 'نظام النقاط في مشروع سمير:\n\nكيفية العمل:\n• ضع الزجاجة الفارغة في آلة النقاط\n• امسح QR Code المطبوع على الزجاجة\n• احصل على نقاط حسب نوع وحجم الزجاجة\n• استبدل النقاط في السوبرماركت والمولات\n\nالفوائد:\n• تحفيز إعادة التدوير\n• ربط مباشر بشركات إعادة التدوير المعتمدة\n• ضمان إعادة تدوير آمنة وصحية\n• دعم الاقتصاد المحلي\n\nالنقاط قابلة للاستبدال بمنتجات أو خصومات في المتاجر المشاركة.';
            }
            
            if (lowerMessage.includes('التنمية المستدامة') || lowerMessage.includes('مستدامة') || lowerMessage.includes('استدامة')) {
                return 'التنمية المستدامة:\n\nالتعريف:\nالتنمية التي تلبي احتياجات الحاضر دون المساس بقدرة الأجيال القادمة على تلبية احتياجاتها.\n\nالأبعاد:\n• البيئي: حماية الموارد الطبيعية والتنوع البيولوجي\n• الاقتصادي: نمو اقتصادي عادل ومستدام\n• الاجتماعي: عدالة اجتماعية ورفاهية الإنسان\n\nفي مشروع سمير:\n• حماية البيئة من التلوث البلاستيكي\n• دعم الاقتصاد عبر صناعة إعادة التدوير\n• تعزيز الوعي المجتمعي والمشاركة\n• الحفاظ على التراث الثقافي\n\nالهدف: جعل مصر نموذجاً رائداً في المنطقة.';
            }
            
            if (lowerMessage.includes('من نحن') || lowerMessage.includes('فريق') || lowerMessage.includes('نحن')) {
                return 'من نحن:\n\nنحن فريق مخصص لحماية الإسكندرية وتراثها من المخاطر المناخية والبيئية.\n\nرؤيتنا:\nجعل مصر نموذجاً رائداً في المنطقة للاستدامة وحماية التراث.\n\nمهمتنا:\n• ربط المعرفة الأكاديمية بالعمل الشعبي\n• تطوير حلول عملية للتحديات البيئية\n• تعزيز الوعي المجتمعي\n• دعم الاقتصاد الأخضر\n\nمشروع سمير:\nهو أداة ذكية تجمع بين التكنولوجيا والبيئة والتراث لخدمة المجتمع وضمان مستقبل مستدام.\n\nنؤمن أن الحلول البسيطة والذكية يمكن أن تحدث فرقاً كبيراً.';
            }
            
            // Check for greetings
            if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey') || (isArabic && (lowerMessage.includes('مرحبا') || lowerMessage.includes('مرحبًا') || lowerMessage.includes('اهلا') || lowerMessage.includes('أهلا')))) {
                return getRandomResponse(chatbotData.responses.greetings);
            }
            
            // Check for help requests
            if (lowerMessage.includes('help') || lowerMessage.includes('what can you do') || (isArabic && (lowerMessage.includes('مساعدة') || lowerMessage.includes('تساعدني') || lowerMessage.includes('ماذا تفعل') || lowerMessage.includes('كيف تعمل')))) {
                return getRandomResponse(chatbotData.responses.help);
            }
            
            // Check for quiz requests
            if (lowerMessage.includes('quiz') || lowerMessage.includes('test') || (isArabic && (lowerMessage.includes('اختبار') || lowerMessage.includes('امتحان') || lowerMessage.includes('كويز')))) {
                return 'يمكنني مساعدتك في الاختبارات! اذهب إلى تبويب Quiz لرؤية الاختبارات المتاحة. يمكنك خوض اختبارات حول الرياضيات أو العلوم أو الإسكندرية والمناخ.';
            }
            
            // Search for relevant text content
            for (const text of chatbotData.texts) {
                for (const keyword of text.keywords) {
                    if (lowerMessage.includes(keyword)) {
                        return `إليك ما أعرفه عن ${text.title}:\n\n${text.content}`;
                    }
                }
            }
            
            // Default response
            return getRandomResponse(chatbotData.responses.unknown);
        }

        function getRandomResponse(responses) {
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Quiz functionality
        function loadQuizzes() {
            if (!chatbotData) return;
            
            const quizList = document.getElementById('quiz-list');
            quizList.innerHTML = '';
            
            chatbotData.quizzes.forEach(quiz => {
                const quizItem = document.createElement('div');
                quizItem.className = 'quiz-item';
                quizItem.innerHTML = `<h4>${quiz.title}</h4><p>${quiz.questions.length} questions</p>`;
                quizItem.onclick = () => startQuiz(quiz);
                quizList.appendChild(quizItem);
            });
        }

        function startQuiz(quiz) {
            currentQuiz = quiz;
            currentQuestionIndex = 0;
            userAnswers = [];
            quizScore = 0;
            
            document.getElementById('quiz-selection').style.display = 'none';
            document.getElementById('quiz-content').style.display = 'block';
            
            document.getElementById('quiz-title').textContent = quiz.title;
            document.getElementById('total-questions').textContent = quiz.questions.length;
            
            showQuestion();
        }

        function showQuestion() {
            const question = currentQuiz.questions[currentQuestionIndex];
            
            document.getElementById('current-question').textContent = currentQuestionIndex + 1;
            document.getElementById('quiz-question').textContent = question.question;
            
            const optionsDiv = document.getElementById('quiz-options');
            optionsDiv.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionButton = document.createElement('button');
                optionButton.className = 'option';
                optionButton.textContent = option;
                optionButton.onclick = () => selectOption(index);
                optionsDiv.appendChild(optionButton);
            });
            
            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
            document.getElementById('next-btn').style.display = currentQuestionIndex < currentQuiz.questions.length - 1 ? 'inline-block' : 'none';
            document.getElementById('submit-btn').style.display = currentQuestionIndex === currentQuiz.questions.length - 1 ? 'inline-block' : 'none';
        }

        function selectOption(optionIndex) {
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });
            
            const selectedOption = document.querySelectorAll('.option')[optionIndex];
            selectedOption.classList.add('selected');
            
            const question = currentQuiz.questions[currentQuestionIndex];
            const isCorrect = optionIndex === question.correct;
            
            if (isCorrect) {
                selectedOption.classList.add('correct');
            } else {
                selectedOption.classList.add('incorrect');
                document.querySelectorAll('.option')[question.correct].classList.add('correct');
            }
            
            userAnswers[currentQuestionIndex] = optionIndex;
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < currentQuiz.questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            }
        }

        function submitQuiz() {
            let correctAnswers = 0;
            currentQuiz.questions.forEach((question, index) => {
                if (userAnswers[index] === question.correct) {
                    correctAnswers++;
                }
            });
            
            quizScore = Math.round((correctAnswers / currentQuiz.questions.length) * 100);
            
            // --- Save quiz score to localStorage for profile stats ---
            const stats = JSON.parse(localStorage.getItem('samir_stats') || '{}');
            const currentQuizScore = Number(stats.quizScore) || 0;
            
            // Update quiz score (keep highest score)
            if (quizScore > currentQuizScore) {
                stats.quizScore = quizScore;
                localStorage.setItem('samir_stats', JSON.stringify(stats));
                console.log('Updated quiz score:', quizScore);
            }
            
            showQuizResults();
        }

        function showQuizResults() {
            const resultsDiv = document.getElementById('quiz-results');
            const performance = quizScore >= 70 ? 'ممتاز!' : quizScore >= 50 ? 'جيد!' : 'يحتاج تحسين!';
            const emoji = quizScore >= 70 ? '🎉' : quizScore >= 50 ? '👏' : '💪';
            
            resultsDiv.innerHTML = `
                <div class="score">${emoji} Good Job! ${emoji}</div>
                <div class="score">نقاطك: ${quizScore}%</div>
                <p>${performance}</p>
                <button onclick="restartQuiz()" class="quiz-controls" style="margin-top: 20px;">Take Another Quiz / اختبار آخر</button>
            `;
            resultsDiv.style.display = 'block';
            document.getElementById('quiz-content').style.display = 'block';
        }

        function restartQuiz() {
            document.getElementById('quiz-selection').style.display = 'block';
            document.getElementById('quiz-content').style.display = 'none';
            document.getElementById('quiz-results').style.display = 'none';
        }
    </script>
</body>
</html>



